spdata,
tidyverse)
p_load(maps,
usdata,
dplyr,
extrafont,
showtext,
ggtext,
ggrepel,
readxl,
sf,
spData,
tidyverse)
add_new_var = function(x, var1, var2, nbins, style = "quantile"){
class1 = suppressWarnings(findCols(classIntervals(c(x[[var1]]),
n = nbins,
style = style)))
class2 = suppressWarnings(findCols(classIntervals(c(x[[var2]]),
n = nbins,
style = style)))
x$new_class = class1 + nbins * (class2 - 1)
return(x)
}
crashes <- add_new_var(tryit,
var1 = "Dark_unlightedlighted",
var2 = "Dark_lighted",
nbins = 3)
library(biscale)
data <- bi_class(crashes, x = Dark_unlightedlighted, y = Dark_lighted, style = "quantile", dim = 3)
head(data)
crashes_bucketed <- bi_class(crashes, x = Dark_unlightedlighted, y = Dark_lighted, style = "quantile", dim = 3)
rm(data)
# merging datasets (2020 updates to tibble package require updates to R and sf must be loaded)
crash_counties <- left_join(crashes_bucketed, counties, by=c("Lookup_county"="NAME"))
head(crash_counties)
ggplot()+
geom_sf(data = crash_counties,
mapping = aes(fill = bi_class),
color = "white",
size = 0.1,
show.legend = FALSE) +
bi_scale_fill(pal = "DkBlue", dim = 3) +
bi_theme() +
# geom_polygon(
#   data=world_map_df,
#   aes(x=long,y=lat,group=group, fill=bi_class),
#   color=background, size=0.2
# )+
# guides(fill =
#          guide_legend(title.position = "top",
#                       title.hjust =0.5,
#                       nrow = 1))+
# geom_polygon(
#   data=world_map_df%>%filter(is.na(kg_capita)),
#   aes(x=long,y=lat,group=group),
#   fill="grey",
#   color=background, size=0.2
# )+
# scale_fill_manual(values=colors, na.translate = F)+
# geom_point(
#   data=point_df,
#   inherit.aes=F,
#   aes(x=point_long,y=point_lat),
#   color='#2E1F27'
# )+
# geom_segment(data = arrows, aes(x = x1, y = y1, xend = x2, yend = y2),
#              arrow = arrow(length = unit(0.07, "inch")), size = 0.4,
#              color = annotation_color)+
# geom_textbox(
#   data=text_df%>%filter(text_desc %in% c("C1","C4")),
#   aes(x=text_long,y=text_lat,label=text_label),
#   size=2.5,
#   width = unit(0.1, "npc"),
#   fill=background,
#   color="white",
#   box.color=annotation_color
# )+
# geom_textbox(
#   data=text_df%>%filter(text_desc %in% c("C3","C2")),
#   aes(x=text_long,y=text_lat,label=text_label),
#   size=2.5,
#   width = unit(0.07, "npc"),
#   fill=background,
#   color="white",
#   box.color=annotation_color
#  coord_map(xlim=c(-180,180))+          # choose the window
theme(
plot.background=element_rect(fill=background),
legend.position="top",
text=element_text(color=font_color, family=chart_font),
plot.title=element_text(family=title_font,hjust=.5,
vjust=5),
plot.subtitle =element_text(hjust=.5, vjust=5),
plot.margin = unit(c(0.8, 4.2, 0.8, 4.2), "cm")
)+
labs(
title="Accident rates with and without lighting",
subtitle="For Motorcycles, Bicycles, and Motorized Bicycles",
fill="Accidents",
caption="Data from CDOT | Chart @hellville"
)
background<-'#211c1d'
font_color<-"white"
annotation_color<-"#05803e"
ggplot()+
geom_sf(data = crash_counties,
mapping = aes(fill = bi_class),
color = "white",
size = 0.1,
show.legend = FALSE) +
bi_scale_fill(pal = "DkBlue", dim = 3) +
bi_theme() +
# geom_polygon(
#   data=world_map_df,
#   aes(x=long,y=lat,group=group, fill=bi_class),
#   color=background, size=0.2
# )+
# guides(fill =
#          guide_legend(title.position = "top",
#                       title.hjust =0.5,
#                       nrow = 1))+
# geom_polygon(
#   data=world_map_df%>%filter(is.na(kg_capita)),
#   aes(x=long,y=lat,group=group),
#   fill="grey",
#   color=background, size=0.2
# )+
# scale_fill_manual(values=colors, na.translate = F)+
# geom_point(
#   data=point_df,
#   inherit.aes=F,
#   aes(x=point_long,y=point_lat),
#   color='#2E1F27'
# )+
# geom_segment(data = arrows, aes(x = x1, y = y1, xend = x2, yend = y2),
#              arrow = arrow(length = unit(0.07, "inch")), size = 0.4,
#              color = annotation_color)+
# geom_textbox(
#   data=text_df%>%filter(text_desc %in% c("C1","C4")),
#   aes(x=text_long,y=text_lat,label=text_label),
#   size=2.5,
#   width = unit(0.1, "npc"),
#   fill=background,
#   color="white",
#   box.color=annotation_color
# )+
# geom_textbox(
#   data=text_df%>%filter(text_desc %in% c("C3","C2")),
#   aes(x=text_long,y=text_lat,label=text_label),
#   size=2.5,
#   width = unit(0.07, "npc"),
#   fill=background,
#   color="white",
#   box.color=annotation_color
#  coord_map(xlim=c(-180,180))+          # choose the window
theme(
plot.background=element_rect(fill=background),
legend.position="top",
text=element_text(color=font_color, family=chart_font),
plot.title=element_text(family=title_font,hjust=.5,
vjust=5),
plot.subtitle =element_text(hjust=.5, vjust=5),
plot.margin = unit(c(0.8, 4.2, 0.8, 4.2), "cm")
)+
labs(
title="Accident rates with and without lighting",
subtitle="For Motorcycles, Bicycles, and Motorized Bicycles",
fill="Accidents",
caption="Data from CDOT | Chart @hellville"
)
head(crash_counties)
crash_counties <- left_join(counties, crashes_bucketed, by=c("NAME"="Lookup_county"))
ggplot()+
geom_sf(data = crash_counties,
mapping = aes(fill = bi_class),
color = "white",
size = 0.1,
show.legend = FALSE) +
bi_scale_fill(pal = "DkBlue", dim = 3) +
bi_theme() +
# geom_polygon(
#   data=world_map_df,
#   aes(x=long,y=lat,group=group, fill=bi_class),
#   color=background, size=0.2
# )+
# guides(fill =
#          guide_legend(title.position = "top",
#                       title.hjust =0.5,
#                       nrow = 1))+
# geom_polygon(
#   data=world_map_df%>%filter(is.na(kg_capita)),
#   aes(x=long,y=lat,group=group),
#   fill="grey",
#   color=background, size=0.2
# )+
# scale_fill_manual(values=colors, na.translate = F)+
# geom_point(
#   data=point_df,
#   inherit.aes=F,
#   aes(x=point_long,y=point_lat),
#   color='#2E1F27'
# )+
# geom_segment(data = arrows, aes(x = x1, y = y1, xend = x2, yend = y2),
#              arrow = arrow(length = unit(0.07, "inch")), size = 0.4,
#              color = annotation_color)+
# geom_textbox(
#   data=text_df%>%filter(text_desc %in% c("C1","C4")),
#   aes(x=text_long,y=text_lat,label=text_label),
#   size=2.5,
#   width = unit(0.1, "npc"),
#   fill=background,
#   color="white",
#   box.color=annotation_color
# )+
# geom_textbox(
#   data=text_df%>%filter(text_desc %in% c("C3","C2")),
#   aes(x=text_long,y=text_lat,label=text_label),
#   size=2.5,
#   width = unit(0.07, "npc"),
#   fill=background,
#   color="white",
#   box.color=annotation_color
#  coord_map(xlim=c(-180,180))+          # choose the window
theme(
plot.background=element_rect(fill=background),
legend.position="top",
text=element_text(color=font_color, family=chart_font),
plot.title=element_text(family=title_font,hjust=.5,
vjust=5),
plot.subtitle =element_text(hjust=.5, vjust=5),
plot.margin = unit(c(0.8, 4.2, 0.8, 4.2), "cm")
)+
labs(
title="Accident rates with and without lighting",
subtitle="For Motorcycles, Bicycles, and Motorized Bicycles",
fill="Accidents",
caption="Data from CDOT | Chart @hellville"
)
ggplot()+
geom_sf(data = crash_counties,
mapping = aes(fill = bi_class),
color = "white",
size = 0.1,
show.legend = FALSE) +
bi_scale_fill(pal = "DkBlue", dim = 3) +
bi_theme(
base_family = chart_font,
base_size = 24,
bg_color = background,
font_color = font_color
) +
# geom_polygon(
#   data=world_map_df,
#   aes(x=long,y=lat,group=group, fill=bi_class),
#   color=background, size=0.2
# )+
# guides(fill =
#          guide_legend(title.position = "top",
#                       title.hjust =0.5,
#                       nrow = 1))+
# geom_polygon(
#   data=world_map_df%>%filter(is.na(kg_capita)),
#   aes(x=long,y=lat,group=group),
#   fill="grey",
#   color=background, size=0.2
# )+
# scale_fill_manual(values=colors, na.translate = F)+
# geom_point(
#   data=point_df,
#   inherit.aes=F,
#   aes(x=point_long,y=point_lat),
#   color='#2E1F27'
# )+
# geom_segment(data = arrows, aes(x = x1, y = y1, xend = x2, yend = y2),
#              arrow = arrow(length = unit(0.07, "inch")), size = 0.4,
#              color = annotation_color)+
# geom_textbox(
#   data=text_df%>%filter(text_desc %in% c("C1","C4")),
#   aes(x=text_long,y=text_lat,label=text_label),
#   size=2.5,
#   width = unit(0.1, "npc"),
#   fill=background,
#   color="white",
#   box.color=annotation_color
# )+
# geom_textbox(
#   data=text_df%>%filter(text_desc %in% c("C3","C2")),
#   aes(x=text_long,y=text_lat,label=text_label),
#   size=2.5,
#   width = unit(0.07, "npc"),
#   fill=background,
#   color="white",
#   box.color=annotation_color
#  coord_map(xlim=c(-180,180))+          # choose the window
# theme(
#   plot.background=element_rect(fill=background),
#   legend.position="top",
#   text=element_text(color=font_color, family=chart_font),
#   plot.title=element_text(family=title_font,hjust=.5,
#                           vjust=5),
#   plot.subtitle =element_text(hjust=.5, vjust=5),
#   plot.margin = unit(c(0.8, 4.2, 0.8, 4.2), "cm")
# )+
labs(
title="Accident rates with and without lighting",
subtitle="For Motorcycles, Bicycles, and Motorized Bicycles",
fill="Accidents",
caption="Data from CDOT | Chart @hellville"
)
ggplot()+
geom_sf(data = crash_counties,
mapping = aes(fill = bi_class),
color = "white",
size = 0.1,
show.legend = FALSE) +
bi_scale_fill(pal = "GrPink", dim = 3) +
bi_theme(
base_family = chart_font,
base_size = 24,
bg_color = font_color,
font_color = font_color
) +
labs(
title="Accident rates with and without lighting",
subtitle="For Motorcycles, Bicycles, and Motorized Bicycles",
fill="Accidents",
caption="Data from CDOT | Chart @hellville"
)
ggplot()+
geom_sf(data = crash_counties,
mapping = aes(fill = bi_class),
color = "white",
size = 0.1,
show.legend = FALSE) +
bi_scale_fill(pal = "GrPink", dim = 3) +
bi_theme(
base_family = chart_font,
base_size = 24,
bg_color = font_color,
font_color = background
) +
labs(
title="Accident rates with and without lighting",
subtitle="For Motorcycles, Bicycles, and Motorized Bicycles",
fill="Accidents",
caption="Data from CDOT | Chart @hellville"
)
ggplot()+
geom_sf(data = crash_counties,
mapping = aes(fill = bi_class),
color = "white",
size = 0.1,
show.legend = FALSE) +
bi_scale_fill(pal = "GrPink", dim = 3) +
bi_theme(
base_family = chart_font,
base_size = 24,
bg_color = font_color,
font_color = background
) +
labs(
title="Accident rates with and without lighting",
subtitle="For Motorcycles, Bicycles, and Motorized Bicycles",
fill="Accidents",
caption="Data from CDOT | @hellville"
)
ggplot()+
geom_sf(data = crash_counties,
mapping = aes(fill = bi_class),
color = "white",
size = 0.1,
show.legend = FALSE) +
bi_scale_fill(pal = "GrPink", dim = 3) +
bi_theme(
base_family = chart_font,
base_size = 24,
bg_color = background,
font_color = font_color
) +
labs(
title="Accident rates with and without lighting",
subtitle="For Motorcycles, Bicycles, and Motorized Bicycles",
fill="Accidents",
caption="Data from CDOT | @hellville"
)
font_color<-'#211c1d'
background<-"white"
ggplot()+
geom_sf(data = crash_counties,
mapping = aes(fill = bi_class),
color = "white",
size = 0.1,
show.legend = FALSE) +
bi_scale_fill(pal = "GrPink", dim = 3) +
bi_theme(
base_family = chart_font,
base_size = 24,
bg_color = background,
font_color = font_color
) +
labs(
title="Accident rates with and without lighting",
subtitle="For Motorcycles, Bicycles, and Motorized Bicycles",
fill="Accidents",
caption="Data from CDOT | @hellville"
)
# legend
legend <- bi_legend(pal = "DkBlue",
dim = 3,
xlab = "Higher % White ",
ylab = "Higher Income ",
size = 8)
warnings()
ggplot()+
geom_sf(data = crash_counties,
mapping = aes(fill = bi_class),
color = "white",
size = 0.1,
show.legend = FALSE) +
bi_scale_fill(pal = "GrPink", dim = 3) +
bi_theme(
base_family = chart_font,
base_size = 24,
bg_color = background,
font_color = font_color
) +
draw_plot(legend, 0.2, .65, 0.2, 0.2) +
labs(
title="Accident rates with and without lighting",
subtitle="For Motorcycles, Bicycles, and Motorized Bicycles",
fill="Accidents",
caption="Data from CDOT | @hellville"
)
p_load(maps,
usdata,
dplyr,
extrafont,
showtext,
ggtext,
ggrepel,
readxl,
sf,
biscale,      # save yourself the hassle of defining classes
cowplot,
tidyverse)
ggplot()+
geom_sf(data = crash_counties,
mapping = aes(fill = bi_class),
color = "white",
size = 0.1,
show.legend = FALSE) +
bi_scale_fill(pal = "GrPink", dim = 3) +
bi_theme(
base_family = chart_font,
base_size = 24,
bg_color = background,
font_color = font_color
) +
draw_plot(legend, 0.2, .65, 0.2, 0.2) +
labs(
title="Accident rates with and without lighting",
subtitle="For Motorcycles, Bicycles, and Motorized Bicycles",
fill="Accidents",
caption="Data from CDOT | @hellville"
)
# legend
legend <- bi_legend(pal = "DkBlue",
dim = 3,
xlab = "Higher % White ",
ylab = "Higher Income ",
size = 8)
# legend
legend <- bi_legend(pal = "GrPink",
dim = 3,
xlab = "More unlit crashes",
ylab = "More lit crashes",
size = 8)
ggplot()+
geom_sf(data = crash_counties,
mapping = aes(fill = bi_class),
color = "white",
size = 0.1,
show.legend = FALSE) +
bi_scale_fill(pal = "GrPink", dim = 3) +
bi_theme(
base_family = chart_font,
base_size = 24,
bg_color = background,
font_color = font_color
) +
draw_plot(legend, 0.2, .65, 0.2, 0.2) +
labs(
title="Accident rates with and without lighting",
subtitle="For Motorcycles, Bicycles, and Motorized Bicycles",
fill="Accidents",
caption="Data from CDOT | @hellville"
)
font_add("Corbel", "C:/Windows/Fonts/corbel.ttf")              # Use the actual file path
warnings()
font_add("Corbel", "C://Windows//Fonts//corbel.ttf")              # Use the actual file path
font_add("Impact", "C://Windows//Fonts//impact.ttf")              # Use the actual file path formerly gill sans bold
chart_font<-"Corbel"
title_font<-"Impact"
d'
background<-"white"
annotation_color<-"
# legend
legend <- bi_legend(pal = "GrPink",
dim = 3,
xlab = "More unlit crashes",
ylab = "More lit crashes",
size = 8)
